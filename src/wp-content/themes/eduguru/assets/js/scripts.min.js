jQuery(function ($) {
    //Получаем параметр в url
    $.urlParam = function (name) {
        const results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.search);
        return (results !== null) ? results[1] || 0 : false;
    }
    
    let params = $.urlParam('tags');
    if (params){
        //берем все параметры tags и разделяем
        paramsTags = params.replaceAll('%20','+').split('+');
        
        //перебираем теги и делаем отмеченными  
        for(i=0; i<paramsTags.length; i++){
            $('.filter_item input[name="'+paramsTags[i]+'"]').attr('checked', true);
        }
    }
    //при клике по тегу меняем url
    $('.filter_item input').on('change',function(){
        current_page = 1;

        let tag = '.filter_item input:checked';
        tags = '';
        if ($(tag).length > 0){
            for (i=0; $(tag).length > i; i++){
                tags+= $(tag+':eq('+i+')').attr('name')+'+';
            }
            tags = 'tags='+tags.slice(0,-1);
        }
        history.pushState(null, null, '?'+tags);

        $.urlParam('tags')?tags = $.urlParam('tags'): tags = '';
//ajax
        const posts = 2;

        const button = $(".btn--load");
        const data = {
            "action": "load_more",
            "page": 1,
            "tags": tags,
            "posts": posts,
            "filter": true
        }
        $.ajax({
            url: "/wp-admin/admin-ajax.php",
            data: data,
            type: "POST",
            success: function (data) {
                if (data) {
                    $('.cards.container').find('.card_wrap').remove();
                    $('.cards.container').append(data);
                } else {
                    button.hide();
                }
            }
        });
    })
})

jQuery(function ($) {
    current_page = 1;
    $(".btn--load").on("click", function () {
        const button = $(this);
        button.find('.loadmore').text("Загрузка...");

        let left = $('.quantity_results').text().replace(/[^0-9]/g,"") - $('.card_wrap').length;
        let posts = 2;
    
        if (left < posts){ posts = left };

        const data = {
            "action": "load_more",
            "page": current_page+1,
            "posts": posts
        }
        $.ajax({
            url: "/wp-admin/admin-ajax.php",
            data: data,
            type: "POST",
            success: function (data) {
                if (data) {
                    button.find('.loadmore').text("показать больше");
                    button.prev('.cards.container').append(data);
                    current_page++;
                    if (current_page == button.attr("data-max-pages")) {
                        button.hide();
                        console.log('more-if-2');
                    }
                } else {
                    button.hide();
                    console.log('more-else');
                }
            }
        });
    });
});
jQuery(function ($) {
    $('.more_btn').on('change', moreToggle);
        function moreToggle(e) {

            let label = $(this).find('label');

            let hide =  'скрыть'
            if($(label).attr('for') == 'filter_more'){
                show = 'показать больше параметров';
                wrap = $(this).closest('.filter').find('.filter_items');
            }else{
                show = 'показать больше';
                wrap = $(this).closest('.card').find('.detail');
            }
            
            $(wrap).toggleClass('show')?$(label).text(hide) : $(label).text(show);
        }
    });