jQuery(function ($) {
    filterVissible = function(){ 

        if ($('.filter_items').height() > 130){
            $('.filter .more_btn').addClass('show');
        }else{
            $('.filter .more_btn').removeClass('show');
        }
    }

    //Получаем параметр в url
    $.urlParam = function (name) {
        const results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.search);
        return (results !== null) ? results[1] || 0 : false;
    }
    
    let params = $.urlParam('tags');
    if (params){
        //берем все параметры tags и разделяем
        paramsTags = params.replaceAll('%20','+').split('+');
        
        //перебираем теги и делаем отмеченными  
        for(i=0; i<paramsTags.length; i++){
            $('.filter_item input[name="'+paramsTags[i]+'"]').attr('checked', true);
        }
    }
    //при клике по тегу меняем url
    $('.filter_item input').on('change',function(){
        current_page = 1;

        let tag = '.filter_item input:checked';
        tags = '';
        if ($(tag).length > 0){
            for (i=0; $(tag).length > i; i++){
                tags+= $(tag+':eq('+i+')').attr('name')+'+';
            }
            tags = 'tags='+tags.slice(0,-1);
        }

        if(tags == ''){
            history.pushState(null, null, location.pathname);
        }else{
            history.pushState(null, null, '?'+tags);
        }

        $.urlParam('tags')?tags = $.urlParam('tags'): tags = '';
//ajax
        const posts = 10;

        const button = $(".btn--load");
        const data = {
            "action": "load_more",
            "page": 1,
            "tags": tags,
            "posts": posts,
            "filter": true
        }
        $.ajax({
            url: "/wp-admin/admin-ajax.php",
            data: data,
            type: "POST",
            success: function (data) {
                if (data) {
                    $('.cards.container').find('.card_wrap').remove();
                    $('.cards.container').append(data);
                } else {
                    button.hide();
                }
            }
        });
        filterVissible()
    })
})
jQuery(function ($) {
    current_page = 1;
    $(".btn--load").on("click", function () {
        const button = $(this);
        button.find('.loadmore').text("Загрузка...");

        let left = $('.quantity_results').text().replace(/[^0-9]/g,"") - $('.card_wrap').length;
        let posts = 10;
    
        if (left < posts){ posts = left };

        const data = {
            "action": "load_more",
            "page": current_page+1,
            "posts": posts
        }
        $.ajax({
            url: "/wp-admin/admin-ajax.php",
            data: data,
            type: "POST",
            success: function (data) {
                if (data) {
                    button.find('.loadmore').text("показать больше");
                    button.prev('.cards.container').append(data);
                    current_page++;
                    fixHeight();
                    if (current_page == button.attr("data-max-pages")) {
                        button.hide();
                    }
                } else {
                    button.hide();
                }
            }
        });
    });
});
    show_btn = function each(el,show,hide){
        
        if (typeof el == 'string'){el = document.querySelector(el)}

        if (el.getAttribute('for') == 'filter_more'){
        wrap = el.closest('.filter').querySelector('.filter_wrap');
        }else{
        wrap = el.closest('.card').querySelector('.detail');
        }
        //console.log(wrap)
        wrap.classList.toggle('show')

        if( window.getComputedStyle(el,':before').transform == 'none' ){
            el.textContent = hide
        }else{
            el.textContent = show
        }
    }
jQuery(function ($) {

        fixWidth = function(){
            let block = '.counter_item_num';
            width=[];
            for(i=0; i<$(block).length; i++){
                width.push($(block+':eq('+i+')').width());
            }
            width = Math.max.apply(null, width);
            $(block).attr('style','width:'+width+'px');
        }
        

        fixHeight = function(){
            let card = '.card_wrap'

            for(i=0; i<$(card).length; i++){
                
                let block = card+':eq('+i+')'+' .card_step_tittle';
                height=[];
                for(b=0; b<$(block).length; b++){
                    height.push($(block+':eq('+b+')').outerHeight());
                }

                height = Math.max.apply(null, height);
                $(block).attr('style','height:'+height+'px');
            }
        }
        
        window.onload = function(){
            fixHeight()            
            filterVissible()
            if (innerWidth <= 640){
                fixWidth()
            }
        }
})
jQuery(function ($) {
    $('#burger').on('change',function(){
        $('body').toggleClass('hidden')
    })

    $('.menu-item-has-children').click(function(e){
        
        e.stopPropagation()
        if (innerWidth<=960){
            if (!$(this).hasClass('already-clicked')) {
                $(this).addClass('already-clicked')
                e.preventDefault();
            }
        }

        $(this).toggleClass('active')
    })
})